name: Compile Examples

on: [pull_request, push]

jobs:
  compile-test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        fqbn: [
          #"arduino:avr"
          "arduino:avr:yun",
          "arduino:avr:uno",
          "arduino:avr:diecimila",
          "arduino:avr:nano",
          "arduino:avr:mega",
          "arduino:avr:megaADK" #,
          #"arduino:avr:leonardo",
          #"arduino:avr:leonardoeth",
          #"arduino:avr:micro",
          #"arduino:avr:esplora",
          #"arduino:avr:mini",
          #"arduino:avr:ethernet",
          #"arduino:avr:fio",
          #"arduino:avr:bt",
          #"arduino:avr:LilyPadUSB",
          #"arduino:avr:lilypad",
          #"arduino:avr:pro",
          #"arduino:avr:atmegang",
          #"arduino:avr:robotControl",
          #"arduino:avr:robotMotor",
          #"arduino:avr:gemma",
          #"arduino:avr:circuitplay32u4cat",
          #"arduino:avr:yunmini",
          #"arduino:avr:chiwawa",
          #"arduino:avr:one",
          #"arduino:avr:unowifi"
        ]
        #test: [
        #  "AIO_LED_Pot" ,
        #  "FONAtest",
        #  "IsMegunoLinkConnected"
        #]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2     

      - name: Compile examples
        uses: per1234/actions/libraries/compile-examples@9acb47abcea28afced4d549585b347668eb03eac
        with:
          fqbn: ${{ matrix.fqbn }}
          libraries: |
            - name: MFRC522
            - name: Keyboard
            - name: Mouse
            - name: Servo
            - name: LiquidCrystal
            - name: CapacitiveSensor
          platforms: |
            # Use Board Manager to install the latest release of Arduino AVR Boards to get the toolchain
            - name: "arduino:avr"
            # Overwrite the Board Manager installation with the local platform
            - source-path: "./"
              name: "arduino:avr"
          sketch-paths: '"libraries" "/github/home/Arduino/libraries/MFRC522/examples" "extras/shared/examples"'
          verbose: 'true'

  compile-test-MultiSerial:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        fqbn_MultiSerial: [
          "arduino:avr:mega",
          "arduino:avr:megaADK"
        ]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Compile examples for MultiSerial
        uses: per1234/actions/libraries/compile-examples@9acb47abcea28afced4d549585b347668eb03eac
        with:
          fqbn: ${{ matrix.fqbn_MultiSerial }}
          libraries: |
            - name: MFRC522
            - name: Keyboard
            - name: Mouse
            - name: Servo
            - name: LiquidCrystal
            - name: CapacitiveSensor
          platforms: |
            # Use Board Manager to install the latest release of Arduino AVR Boards to get the toolchain
            - name: "arduino:avr"
            # Overwrite the Board Manager installation with the local platform
            - source-path: "./"
              name: "arduino:avr"
          sketch-paths: '"extras/shared/MultiSerial" "extras/shared/SerialPassthrough"'
          verbose: 'true'

  compile-test-USB:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        fqbn_USB: [
          "arduino:avr:yun",
          "arduino:avr:leonardo",
          "arduino:avr:leonardoeth",
          "arduino:avr:micro",
          "arduino:avr:esplora",
          "arduino:avr:LilyPadUSB",
          "arduino:avr:robotControl",
          "arduino:avr:robotMotor",
          "arduino:avr:circuitplay32u4cat",
          "arduino:avr:yunmini",
          "arduino:avr:chiwawa",
          "arduino:avr:one"
        ]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Compile examples for USB
        uses: per1234/actions/libraries/compile-examples@9acb47abcea28afced4d549585b347668eb03eac
        with:
          fqbn: ${{ matrix.fqbn_USB }}
          libraries: |
            - name: MFRC522
            - name: Keyboard
            - name: Mouse
            - name: Servo
            - name: LiquidCrystal
            - name: CapacitiveSensor
          platforms: |
            # Use Board Manager to install the latest release of Arduino AVR Boards to get the toolchain
            - name: "arduino:avr"
            # Overwrite the Board Manager installation with the local platform
            - source-path: "./"
              name: "arduino:avr"
          sketch-paths: '"extras/shared/09.USB" "extras/shared/MultiSerial" "extras/shared/SerialPassthrough"'
          verbose: 'true'